CREATE TABLE IF NOT EXISTS user_info(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    login VARCHAR(100) NOT NULL,
    password_hash VARCHAR(100) NOT NULL,
    email VARCHAR(200) NOT NULL UNIQUE,
    role VARCHAR(100) NOT NULL DEFAULT 'USER'
);
CREATE UNIQUE INDEX user_info_email_index ON user_info(email);

CREATE TABLE IF NOT EXISTS note(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(100),
    text BYTEA,
    is_attached BOOLEAN DEFAULT FALSE,
    user_id INTEGER NOT NULL REFERENCES user_info(id)
);

CREATE TABLE IF NOT EXISTS attachment(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    file BYTEA,
    extension VARCHAR(6)
);

ALTER TABLE attachment
ADD CONSTRAINT attachment_extension_constraint CHECK ( extension in ('PNG', 'JPEG', 'JPG', 'MP3', 'GIF'));

CREATE TABLE IF NOT EXISTS note_attachments(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    note_id INTEGER NOT NULL REFERENCES note(id),
    attachment_id INTEGER NOT NULL REFERENCES attachment(id)
);
